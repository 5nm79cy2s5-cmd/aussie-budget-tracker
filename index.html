<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>æµ·æ´‹ç°¡ç´„è¨˜å¸³æœ¬ (A$ é ç®—ç‰ˆ)</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"><style>/* åŸºç¤è¨­å®š */body{font-family:'Inter',sans-serif;background-color:#f0f8ff;background-image:linear-gradient(to bottom, #f0f8ff 0%, #e0f7fa 100%)}.macaron-card{background-color:rgba(255,255,255,.92);box-shadow:0 6px 15px -3px rgba(17,80,188,.2),0 4px 8px -2px rgba(17,80,188,.1);border:1px solid #bae6fd;backdrop-filter:blur(3px)}.macaron-button{transition:all .2s;box-shadow:0 4px 8px -1px rgba(6,182,212,.4)}.macaron-button:hover{transform:translateY(-1px);box-shadow:0 6px 12px -1px rgba(6,182,212,.6)}.macaron-input:focus{border-color:#06b6d4;box-shadow:0 0 0 3px rgba(6,182,212,.3)}.budget-over{background-color:#fee2e2;color:#ef4444}.toggle-btn{@apply bg-gray-200 text-gray-700 hover:bg-gray-300}.toggle-btn.active{@apply bg-cyan-500 text-white hover:bg-cyan-600}.calc-btn{@apply w-full h-16 rounded-full text-2xl font-semibold flex items-center justify-center transition duration-100 ease-in-out;box-shadow:0 2px 4px rgba(0,0,0,.1);user-select:none}.calc-btn:active{filter:brightness(1.2)}.op-btn{@apply bg-teal-400 text-white hover:bg-teal-500}.op-btn[data-op="equals"]{@apply bg-blue-600 hover:bg-blue-700}.utility-btn{@apply bg-blue-200 text-gray-800 hover:bg-blue-300}.num-btn{@apply bg-gray-500 text-white hover:bg-gray-600}#category-input-group{@apply bg-cyan-50 p-3 rounded-lg border border-cyan-200}@keyframes float{0%{transform:translate(0,0) rotate(0deg);opacity:.9}50%{transform:translate(5px,-8px) rotate(2deg);opacity:1}100%{transform:translate(0,0) rotate(0deg);opacity:.9}}.jellyfish-icon{animation:float 6s ease-in-out infinite;display:inline-block;font-size:2.25rem;line-height:1;filter:drop-shadow(0 0 5px rgba(0,188,212,.5))}</style></head><body class="min-h-screen p-4 sm:p-8 flex justify-center items-start"><div class="w-full max-w-4xl space-y-8"><header class="text-center"><h1 class="text-4xl font-bold text-blue-800 mb-2 flex justify-center items-center space-x-2"><span class="jellyfish-icon">ğŸª¼</span><span>è¨˜å¸³æœ¬</span><span class="jellyfish-icon">ğŸª¼</span></h1><p class="text-cyan-500">ç´€éŒ„ç”Ÿæ´»ä¸­çš„æ¯ä¸€ç­†æ”¯å‡º</p><p id="user-info" class="text-xs text-gray-500 mt-2">ä½¿ç”¨è€… ID: è¼‰å…¥ä¸­...</p><div class="text-center mt-3"><button id="auth-button" class="px-4 py-2 bg-cyan-500 text-white font-semibold rounded-full hover:bg-cyan-600 transition text-sm shadow-md">ä½¿ç”¨ Google ç™»å…¥</button></div></header><div class="macaron-card rounded-xl p-6"><h2 class="text-xl font-semibold text-gray-600 mb-4">ç¸½è¦½ (æœ¬æœˆ)</h2><div class="flex flex-wrap gap-4 items-stretch"><div class="p-4 bg-teal-100 rounded-xl w-full sm:w-1/3 flex-grow min-w-[150px]"><p class="text-sm font-medium text-teal-600">ç¸½æ”¯å‡º (æœ¬æœˆ)</p><p id="total-expenditure" class="text-3xl font-extrabold text-teal-700 mt-1">A$ 0</p></div><div class="p-4 bg-green-100 rounded-xl w-full sm:w-1/3 flex-grow min-w-[150px]"><p class="text-sm font-medium text-green-500">æœˆåº¦é‹ç‡Ÿé ç®— (A$)</p><p class="text-3xl font-extrabold text-green-600 mt-1">A$ 2940.00</p><p class="text-xs text-green-700 mt-1">(å·²é ç•™å‚™ç”¨é‡‘ A$ 360.00)</p></div><div id="daily-budget-card" class="p-4 bg-blue-100 rounded-xl w-full sm:w-1/3 flex-grow min-w-[150px]"><p id="daily-budget-title" class="text-sm font-medium text-blue-500">ä»Šæ—¥ç›®æ¨™é ç®—</p><p id="daily-remaining-budget" class="text-3xl font-extrabold text-blue-600 mt-1">è¼‰å…¥ä¸­...</p><div class="mt-2 h-1.5 rounded-full bg-blue-200 overflow-hidden"><div id="daily-progress-bar" class="h-full bg-blue-600 transition-all duration-500" style="width: 0%"></div></div></div><div id="error-message" class="text-red-500 text-sm hidden p-2 bg-red-50 rounded-lg w-full mt-2"></div></div><div class="mt-4 w-full"><p class="text-xs font-medium text-gray-500 mb-1">æœˆåº¦é ç®—ä½¿ç”¨ç‡</p><div class="h-2 rounded-full bg-gray-200 overflow-hidden"><div id="monthly-progress-bar" class="h-full bg-teal-500 transition-all duration-500" style="width: 0%"></div></div><p id="monthly-progress-text" class="text-right text-xs mt-1 text-gray-600">0%</p></div></div><div class="macaron-card rounded-xl p-6"><h2 class="text-xl font-semibold text-gray-600 mb-4">æ–°å¢ç´€éŒ„</h2><form id="expense-form" class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div><label for="date" class="block text-sm font-medium text-gray-700">æ—¥æœŸ</label><input type="date" id="date" required class="macaron-input mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 text-gray-700"></div><div id="category-input-group"><label for="category" class="block text-sm font-bold text-cyan-600">é¡åˆ¥ *</label><select id="category" required class="macaron-input mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 text-gray-700 bg-white"><option value="é£Ÿç‰©">é£Ÿç‰© (ğŸ”)</option><option value="äº¤é€š">äº¤é€š (ğŸš—)</option><option value="å¨›æ¨‚">å¨›æ¨‚ (ğŸ¬)</option><option value="è³¼ç‰©">è³¼ç‰© (ğŸ›ï¸)</option><option value="å…¶ä»–">å…¶ä»– (âœ¨)</option></select></div><div><label for="amount" class="block text-sm font-medium text-gray-700">é‡‘é¡ (A$)</label><input type="number" id="amount" required min="0.01" step="0.01" placeholder="100.00" class="macaron-input mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 text-gray-700"></div><div class="md:col-span-1"><label for="description" class="block text-sm font-medium text-gray-700">å‚™è¨» (å¯é¸)</label><input type="text" id="description" placeholder="åˆé¤è²»ç”¨" class="macaron-input mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 text-gray-700"></div></div><button type="submit" class="macaron-button w-full md:w-auto px-6 py-2 bg-cyan-500 text-white font-semibold rounded-lg hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-300 focus:ring-offset-2" disabled>æ–°å¢ç´€éŒ„</button></form></div><div class="macaron-card rounded-xl p-6"><h2 class="text-xl font-semibold text-gray-600 mb-4">å³æ™‚è¨ˆç®—</h2><div class="flex justify-center mb-4 space-x-4"><button id="toggle-basic" class="toggle-btn px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 active">åŸºæœ¬è¨ˆç®—æ©Ÿ</button><button id="toggle-converter" class="toggle-btn px-4 py-2 text-sm font-semibold rounded-lg transition duration-150">åŒ¯ç‡è¨ˆç®—æ©Ÿ</button></div><div id="calculator-basic" class="calculator-mode space-y-2"><input type="text" id="calc-display" value="0" readonly class="macaron-input w-full text-right text-4xl p-4 rounded-lg bg-gray-700 text-white font-light focus:ring-0 select-none shadow-inner"><div class="grid grid-cols-4 gap-2"><button class="calc-btn utility-btn" data-type="clear">AC</button><button class="calc-btn utility-btn" data-type="plusMinus">+/-</button><button class="calc-btn utility-btn" data-type="percent">%</button><button class="calc-btn op-btn" data-op="divide">Ã·</button><button class="calc-btn num-btn" data-val="7">7</button><button class="calc-btn num-btn" data-val="8">8</button><button class="calc-btn num-btn" data-val="9">9</button><button class="calc-btn op-btn" data-op="multiply">Ã—</button><button class="calc-btn num-btn" data-val="4">4</button><button class="calc-btn num-btn" data-val="5">5</button><button class="calc-btn num-btn" data-val="6">6</button><button class="calc-btn op-btn" data-op="subtract">-</button><button class="calc-btn num-btn" data-val="1">1</button><button class="calc-btn num-btn" data-val="2">2</button><button class="calc-btn num-btn" data-val="3">3</button><button class="calc-btn op-btn" data-op="add">+</button><button class="calc-btn num-btn col-span-2 text-left pl-6" data-val="0">0</button><button class="calc-btn num-btn" data-val=".">.</button><button class="calc-btn op-btn" data-op="equals">=</button></div></div><div id="calculator-converter" class="calculator-mode space-y-4 hidden"><h3 class="text-lg font-semibold text-gray-600">åŒ¯ç‡æ›ç®— (A$ â‡Œ NT$)</h3><div class="flex items-center space-x-2"><div class="flex-1"><label id="from-currency-label" for="from-amount" class="block text-sm font-medium text-gray-700">é‡‘é¡ (A$)</label><input type="number" id="from-amount" value="1.00" min="0" step="0.01" class="macaron-input mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 text-2xl text-gray-700"></div><button id="toggle-currency-btn" class="mt-4 p-2 rounded-full bg-cyan-500 text-white hover:bg-cyan-600 transition duration-150 transform hover:rotate-180" title="åˆ‡æ›æ›åŒ¯æ–¹å‘"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg></button><div class="flex-1"><label id="to-currency-label" for="to-amount" class="block text-sm font-medium text-gray-700">æ›ç®—ç‚º (NT$)</label><input type="text" id="to-amount" value="0.00" readonly class="macaron-input mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 text-2xl text-gray-700 bg-gray-100 font-bold"></div></div><div class="p-4 bg-yellow-50 rounded-xl border border-yellow-200"><p class="text-xs text-gray-500">ç•¶å‰åŒ¯ç‡ï¼š1 A$ â‰ˆ 21.0 NT$</p><p class="text-xs text-gray-500 mt-1">æç¤ºï¼šåŒ¯ç‡ç‚ºéœæ…‹æ¨¡æ“¬æ•¸æ“šã€‚</p></div></div></div><div class="macaron-card rounded-xl p-6"><h2 class="text-xl font-semibold text-gray-600 mb-4">æ”¯å‡ºåˆ†æèˆ‡æŸ¥è©¢</h2><div class="space-y-6"><div class="flex items-center justify-between p-2 rounded-lg bg-blue-50 border border-blue-200"><button id="prev-month-btn" class="text-cyan-600 hover:text-cyan-800 p-1 rounded-full bg-white hover:bg-blue-100 transition" disabled><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></button><div id="current-view-month" class="text-lg font-bold text-cyan-700">è¼‰å…¥ä¸­...</div><button id="next-month-btn" class="text-cyan-600 hover:text-cyan-800 p-1 rounded-full bg-white hover:bg-blue-100 transition" disabled><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg></button></div><div id="bar-chart-container" class="space-y-3 pt-4"></div><p id="chart-message" class="text-center text-sm text-gray-500 hidden">æœ¬æœˆå°šç„¡æ”¯å‡ºç´€éŒ„å¯ä¾›åˆ†æã€‚</p></div></div><div class="macaron-card rounded-xl p-6"><h2 class="text-xl font-semibold text-gray-600 mb-4">æ‰€æœ‰ç´€éŒ„</h2><div class="overflow-x-auto"><table class="min-w-full divide-y divide-blue-100"><thead><tr><th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ—¥æœŸ</th><th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é¡åˆ¥</th><th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">é‡‘é¡ (A$)</th><th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">å‚™è¨»</th><th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th></tr></thead><tbody id="expense-list" class="bg-white divide-y divide-blue-50"></tbody></table></div><p id="no-records-message" class="text-center text-gray-400 mt-4 hidden">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹ç´€éŒ„ã€‚</p></div></div><script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import { getFirestore, doc, addDoc, onSnapshot, collection, query, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";setLogLevel('Debug');const TOTAL_FUND_AUD=3300.00;const OPERATIONAL_BUDGET_AUD=2940.00;const EMERGENCY_RESERVE_AUD=360.00;const TOURISM_DAILY_BUDGET=130.00;const SCHOOL_DAILY_BUDGET=80.00;const CATEGORY_ICONS={'é£Ÿç‰©':'ğŸ”','äº¤é€š':'ğŸš—','å¨›æ¨‚':'ğŸ¬','è³¼ç‰©':'ğŸ›ï¸','å…¶ä»–':'âœ¨'};const CATEGORY_COLORS={'é£Ÿç‰©':'bg-red-400','äº¤é€š':'bg-blue-400','å¨›æ¨‚':'bg-green-400','è³¼ç‰©':'bg-yellow-400','å…¶ä»–':'bg-gray-400'};const CONVERSION_RATES={'AUD_TWD':21.0};let app,db,auth,userId=null,isAuthReady=false,viewingMonthYear=null,allMonthsCached=[],conversionMode='AUD_TWD';const expenseForm=document.getElementById('expense-form'),expenseList=document.getElementById('expense-list'),totalExpenditure=document.getElementById('total-expenditure'),userInfoElement=document.getElementById('user-info'),errorMessageElement=document.getElementById('error-message'),noRecordsMessage=document.getElementById('no-records-message'),dailyRemainingBudget=document.getElementById('daily-remaining-budget'),dailyBudgetCard=document.getElementById('daily-budget-card'),dailyBudgetTitle=document.getElementById('daily-budget-title'),toggleBasicBtn=document.getElementById('toggle-basic'),toggleConverterBtn=document.getElementById('toggle-converter'),calcBasicDiv=document.getElementById('calculator-basic'),calcConverterDiv=document.getElementById('calculator-converter'),fromAmountInput=document.getElementById('from-amount'),toAmountInput=document.getElementById('to-amount'),fromCurrencyLabel=document.getElementById('from-currency-label'),toCurrencyLabel=document.getElementById('to-currency-label'),toggleCurrencyBtn=document.getElementById('toggle-currency-btn'),calcDisplay=document.getElementById('calc-display'),calcButtons=document.getElementById('calculator-basic'),monthlyProgressBar=document.getElementById('monthly-progress-bar'),monthlyProgressText=document.getElementById('monthly-progress-text'),dailyProgressBar=document.getElementById('daily-progress-bar'),prevMonthBtn=document.getElementById('prev-month-btn'),nextMonthBtn=document.getElementById('next-month-btn'),currentViewMonth=document.getElementById('current-view-month'),barChartContainer=document.getElementById('bar-chart-container'),chartMessage=document.getElementById('chart-message'),authButton=document.getElementById('auth-button');let allExpensesCache=[];function setupRealtimeListener(a,u){if(!db||!isAuthReady)return;const e=collection(db,getExpensesCollectionPath(a,u));const t=query(e);onSnapshot(t,t=>{const r=t.docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().timestamp?.toMillis()||0}));allExpensesCache=r;const months=r.map(e=>{const t=new Date(e.date);return `${t.getFullYear()}-${t.getMonth()+1}`});allMonthsCached=Array.from(new Set(months)).sort();if(!viewingMonthYear&&allMonthsCached.length>0){viewingMonthYear=allMonthsCached[allMonthsCached.length-1]}filterAndRenderExpenses()},e=>{displayError("å¯¦æ™‚è³‡æ–™ç›£è½å¤±æ•—: "+e.message)})}async function handleGoogleSignIn(){const p=new GoogleAuthProvider();try{await signInWithPopup(auth,p)}catch(e){displayError("Google ç™»å…¥å¤±æ•—: "+e.message)}}async function handleSignOut(){try{await signOut(auth)}catch(e){displayError("ç™»å‡ºå¤±æ•—: "+e.message)}}async function initializeFirebase(){try{const firebaseConfig={apiKey:"AIzaSyCBtxjdZN6E-CIwnf-BnpuJ6KzH16cV8cA",authDomain:"ausie-budget-app.firebaseapp.com",projectId:"ausie-budget-app",storageBucket:"ausie-budget-app.firebasestorage.app",messagingSenderId:"476661760316",appId:"1:476661760316:web:3a5102cdcff236a9a35e39"};const a=firebaseConfig.projectId;app=initializeApp(firebaseConfig);auth=getAuth(app);db=getFirestore(app);onAuthStateChanged(auth,async e=>{const submitBtn=expenseForm.querySelector('button[type="submit"]');if(e){userId=e.uid;userInfoElement.textContent=`ä½¿ç”¨è€… ID: ${userId} | App ID: ${a}`;isAuthReady=true;authButton.textContent='ç™»å‡º';authButton.onclick=handleSignOut;submitBtn.disabled=false;setupRealtimeListener(a,userId)}else{userId=null;isAuthReady=false;userInfoElement.textContent=`ä½¿ç”¨è€… ID: æœªç™»å…¥ | App ID: ${a}`;authButton.textContent='ä½¿ç”¨ Google ç™»å…¥';authButton.onclick=handleGoogleSignIn;submitBtn.disabled=true;expenseList.innerHTML='';barChartContainer.innerHTML='';noRecordsMessage.classList.remove('hidden')}})}catch(e){displayError("Firebase åˆå§‹åŒ–æˆ–èªè­‰å¤±æ•—: "+e.message)}}function displayError(msg){errorMessageElement.textContent=`éŒ¯èª¤: ${msg}`;errorMessageElement.classList.remove('hidden');console.error(msg)}function hideError(){errorMessageElement.classList.add('hidden')}function getExpensesCollectionPath(appId,uid){return `/artifacts/${appId}/users/${uid}/expenses`}function getDaysInMonth(date){return new Date(date.getFullYear(),date.getMonth()+1,0).getDate()}function getMonthDisplay(monthYearStr){const[year,month]=monthYearStr.split('-');return new Date(year,month-1,1).toLocaleString('zh-TW',{year:'numeric',month:'long'})}function updateMonthNav(currentMonthYear){const index=allMonthsCached.indexOf(currentMonthYear);prevMonthBtn.disabled=index===0;nextMonthBtn.disabled=index===allMonthsCached.length-1;currentViewMonth.textContent=getMonthDisplay(currentMonthYear)}function cycleMonth(direction){if(allMonthsCached.length===0)return;const index=allMonthsCached.indexOf(viewingMonthYear);let newIndex=index+direction;if(newIndex>=0&&newIndex<allMonthsCached.length){viewingMonthYear=allMonthsCached[newIndex];filterAndRenderExpenses()}}function calculateBudgetStatus(expenses){const today=new Date();const currentYear=today.getFullYear();const currentMonth=today.getMonth();const currentDate=today.getDate();const todayISO=today.toISOString().split('T')[0];const daysInMonth=getDaysInMonth(today);let dailyTargetBudget;dailyTargetBudget=OPERATIONAL_BUDGET_AUD/daysInMonth;if(currentYear===2025&&currentMonth===11){if(currentDate>=30&&currentDate<=31){dailyTargetBudget=TOURISM_DAILY_BUDGET}}else if(currentYear===2026&&currentMonth===0){if(currentDate>=1&&currentDate<=4){dailyTargetBudget=TOURISM_DAILY_BUDGET}else if(currentDate>=5&&currentDate<=31){dailyTargetBudget=SCHOOL_DAILY_BUDGET}}let todaySpent=0;expenses.forEach(expense=>{if(expense.date.split('T')[0]===todayISO){todaySpent+=expense.amount}});const remainingBudget=dailyTargetBudget-todaySpent;const p=dailyProgressBar;let g=todaySpent/dailyTargetBudget*100;g=Math.min(100,g);p.style.width=g.toFixed(1)+'%';p.classList.remove('bg-blue-600','bg-red-500');p.classList.add(todaySpent>dailyTargetBudget?'bg-red-500':'bg-blue-600');dailyBudgetTitle.textContent=`ä»Šæ—¥ç›®æ¨™é ç®— (A$ ${dailyTargetBudget.toFixed(2)})`;dailyRemainingBudget.textContent=`A$ ${remainingBudget.toFixed(2)}`;dailyBudgetCard.classList.remove('bg-blue-100','budget-over');dailyRemainingBudget.classList.remove('text-blue-600','text-red-600');dailyBudgetTitle.classList.remove('text-blue-500','text-red-500');if(remainingBudget<0){dailyBudgetCard.classList.add('budget-over');dailyRemainingBudget.classList.add('text-red-600');dailyBudgetTitle.classList.add('text-red-500')}else{dailyBudgetCard.classList.add('bg-blue-100');dailyRemainingBudget.classList.add('text-blue-600');dailyBudgetTitle.classList.add('text-blue-500')}}function drawBarChart(data,total){barChartContainer.innerHTML='';chartMessage.classList.add('hidden');if(total===0){chartMessage.classList.remove('hidden');return}data.sort((a,b)=>b.value-a.value);data.forEach(item=>{const percent=(item.value/total*100).toFixed(1);const bar=`<div class="flex items-center space-x-2"><div class="w-1/4 text-sm font-medium text-gray-700 flex items-center">${CATEGORY_ICONS[item.category]} ${item.category}</div><div class="w-3/4"><div class="relative h-6 rounded-full bg-gray-200"><div class="h-6 rounded-full ${CATEGORY_COLORS[item.category]||'bg-cyan-500'} transition-all duration-700" style="width: ${percent}%;"></div><span class="absolute right-0 top-0 bottom-0 text-xs font-bold text-white pr-2 flex items-center">${percent}% (A$ ${item.value.toFixed(2)})</span></div></div></div>`;barChartContainer.insertAdjacentHTML('beforeend',bar);})}function filterAndRenderExpenses(){const expenses=allExpensesCache;let currentMonthSpent=0;const currentMonth=new Date().getMonth();expenses.forEach(item=>{const dateObj=new Date(item.date);if(dateObj.getMonth()===currentMonth)currentMonthSpent+=item.amount});totalExpenditure.textContent=`A$ ${currentMonthSpent.toFixed(2)}`;const monthlyBar=monthlyProgressBar,monthlyText=monthlyProgressText;let progress=currentMonthSpent/OPERATIONAL_BUDGET_AUD*100;monthlyText.textContent=`${progress.toFixed(1)}%`;monthlyBar.classList.remove('bg-teal-500','bg-red-500');if(currentMonthSpent>OPERATIONAL_BUDGET_AUD){monthlyBar.style.width='100%';monthlyBar.classList.add('bg-red-500');monthlyText.classList.add('text-red-500')}else{monthlyBar.style.width=progress.toFixed(1)+'%';monthlyBar.classList.add('bg-teal-500');monthlyText.classList.remove('text-red-500')}calculateBudgetStatus(expenses);if(!viewingMonthYear&&expenses.length>0){const months=expenses.map(e=>{const t=new Date(e.date);return `${t.getFullYear()}-${t.getMonth()+1}`});allMonthsCached=Array.from(new Set(months)).sort();viewingMonthYear=allMonthsCached[allMonthsCached.length-1]}if(!viewingMonthYear){chartMessage.classList.remove('hidden');barChartContainer.innerHTML='';expenseList.innerHTML='';noRecordsMessage.classList.remove('hidden');return}updateMonthNav(viewingMonthYear);let filteredRecords=[],categoryTotals={};expenses.forEach(e=>{const t=new Date(e.date);const monthKey=`${t.getFullYear()}-${t.getMonth()+1}`;if(monthKey===viewingMonthYear){filteredRecords.push(e);categoryTotals[e.category]=(categoryTotals[e.category]||0)+e.amount}});const chartData=Object.keys(categoryTotals).map(e=>({category:e,value:categoryTotals[e]})).filter(e=>e.value>0);const totalForChart=chartData.reduce((sum,item)=>sum+item.value,0);drawBarChart(chartData,totalForChart);expenseList.innerHTML='';if(filteredRecords.length===0){noRecordsMessage.classList.remove('hidden');return}noRecordsMessage.classList.add('hidden');filteredRecords.sort((a,b)=>b.timestamp-a.timestamp);filteredRecords.forEach(e=>{const t=CATEGORY_ICONS[e.category]||'â“';const r=document.createElement('tr');r.className='hover:bg-blue-50 transition duration-150';const n=e.date.split('T')[0];r.innerHTML=`<td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-800">${n}</td><td class="px-3 py-3 whitespace-nowrap text-sm text-cyan-600 font-semibold flex items-center"><span class="mr-2 text-lg">${t}</span> ${e.category}</td><td class="px-3 py-3 whitespace-nowrap text-sm text-right font-bold text-red-500">A$ ${e.amount.toFixed(2)}</td><td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500 hidden sm:table-cell">${e.description||'-'}</td><td class="px-3 py-3 whitespace-nowrap text-right text-sm font-medium"><button data-id="${e.id}" class="delete-btn text-cyan-400 hover:text-red-600 transition duration-150 p-1 rounded-full bg-cyan-50 hover:bg-red-100"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button></td>`;expenseList.appendChild(r)});document.querySelectorAll('.delete-btn').forEach(e=>{e.addEventListener('click',handleDeleteRecord)})}async function handleAddExpense(e){e.preventDefault();if(!isAuthReady||!userId){displayError("è«‹å…ˆç™»å…¥ä»¥æ–°å¢ç´€éŒ„ã€‚");return}const t=document.getElementById('date').value;const r=document.getElementById('category').value;const n=document.getElementById('amount');const d=document.getElementById('description').value.trim();const s=parseFloat(n.value);if(isNaN(s)||s<=0){displayError("è«‹è¼¸å…¥æœ‰æ•ˆçš„é‡‘é¡ã€‚");return}hideError();const i={date:t,category:r,amount:s,description:d,timestamp:serverTimestamp()};try{const a="ausie-budget-app";const e=collection(db,getExpensesCollectionPath(a,userId));await addDoc(e,i);n.value='';document.getElementById('description').value=''}catch(e){displayError("æ–°å¢ç´€éŒ„å¤±æ•—: "+e.message)}}async function handleDeleteRecord(e){const t=e.currentTarget;const r=t.getAttribute('data-id');if(!r)return;try{const a="ausie-budget-app";const e=doc(db,getExpensesCollectionPath(a,userId),r);await deleteDoc(e)}catch(e){displayError("åˆªé™¤ç´€éŒ„å¤±æ•—: "+e.message)}}function toggleCalculatorMode(e){[toggleBasicBtn,toggleConverterBtn].forEach(t=>{t.classList.remove('active');t.classList.remove('bg-cyan-500','text-white');t.classList.add('bg-gray-200','text-gray-700','hover:bg-gray-300')});if(e==='basic'){calcBasicDiv.classList.remove('hidden');calcConverterDiv.classList.add('hidden');toggleBasicBtn.classList.add('active','bg-cyan-500','text-white');toggleBasicBtn.classList.remove('bg-gray-200','text-gray-700','hover:bg-gray-300')}else if(e==='converter'){calcConverterDiv.classList.remove('hidden');calcBasicDiv.classList.add('hidden');toggleConverterBtn.classList.add('active','bg-cyan-500','text-white');toggleConverterBtn.classList.remove('bg-gray-200','text-gray-700','hover:bg-gray-300');performConversion()}}let displayValue='0',firstOperand=null,waitingForSecondOperand=false,operator=null;function updateDisplay(){let e=displayValue;if(e.length>15){e=parseFloat(displayValue).toPrecision(10)}calcDisplay.value=e}function clearCalculator(){displayValue='0';firstOperand=null;waitingForSecondOperand=false;operator=null;updateDisplay()}function inputDigit(e){if(waitingForSecondOperand===true){displayValue=e;waitingForSecondOperand=false}else{if(displayValue==='0'&&e!=='0'){displayValue=e}else if(displayValue!=='0'){displayValue+=e}}updateDisplay()}function inputDecimal(e){if(waitingForSecondOperand===true){displayValue='0'+e;waitingForSecondOperand=false;return}if(!displayValue.includes(e)){displayValue+=e}updateDisplay()}function calculate(e,t,r){if(r==='add')return e+t;if(r==='subtract')return e-t;if(r==='multiply')return e*t;if(r==='divide'){if(t===0){return NaN}return e/t}return t}function handleOperator(e){const t=parseFloat(displayValue);if(operator&&waitingForSecondOperand){operator=e;return}if(firstOperand===null){firstOperand=t}else if(operator){const r=calculate(firstOperand,t,operator);if(isNaN(r)){displayValue='éŒ¯èª¤';clearCalculator();return}displayValue=String(parseFloat(r.toFixed(10)));firstOperand=r}waitingForSecondOperand=true;operator=e;updateDisplay()}function handleSpecialOperation(e){let t=parseFloat(displayValue);if(e==='clear'){clearCalculator();return}if(isNaN(t))return;if(e==='plusMinus'){t=-t}else if(e==='percent'){t/=100}displayValue=String(parseFloat(t.toFixed(10)));updateDisplay()}calcButtons.addEventListener('click',e=>{const{target:t}=e;if(!t.classList.contains('calc-btn'))return;if(t.dataset.val){if(t.dataset.val==='.'){inputDecimal(t.dataset.val)}else{inputDigit(t.dataset.val)}return}if(t.dataset.op){handleOperator(t.dataset.op);return}if(t.dataset.type){handleSpecialOperation(t.dataset.type);return}});function updateConversionDisplay(){let e,t,r;const n=parseFloat(fromAmountInput.value);if(isNaN(n)||n<0){toAmountInput.value='è¼¸å…¥ç„¡æ•ˆ';return}if(conversionMode==='AUD_TWD'){e='A$';t='NT$';r=CONVERSION_RATES.AUD_TWD}else{e='NT$';t='A$';r=1/CONVERSION_RATES.AUD_TWD}fromCurrencyLabel.textContent=`é‡‘é¡ (${e})`;toCurrencyLabel.textContent=`æ›ç®—ç‚º (${t})`;const o=n*r;toAmountInput.value=o.toFixed(2)}function toggleConversionMode(){conversionMode=(conversionMode==='AUD_TWD'?'TWD_AUD':'AUD_TWD');fromAmountInput.value='1.00';updateConversionDisplay()}function performConversion(){updateConversionDisplay()}document.addEventListener('DOMContentLoaded',()=>{const e=new Date().toISOString().split('T')[0];document.getElementById('date').value=e;toggleCalculatorMode('basic');clearCalculator();performConversion();prevMonthBtn.addEventListener('click',()=>cycleMonth(-1));nextMonthBtn.addEventListener('click',()=>cycleMonth(1))});expenseForm.addEventListener('submit',handleAddExpense);toggleBasicBtn.addEventListener('click',()=>toggleCalculatorMode('basic'));toggleConverterBtn.addEventListener('click',()=>toggleCalculatorMode('converter'));fromAmountInput.addEventListener('input',performConversion);toggleCurrencyBtn.addEventListener('click',toggleConversionMode);initializeFirebase();</script></body></html>
